<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUCA | Serhat Kiraz</title>

<style>
/* MEVCUT STÄ°LLER AYNI KALACAK */
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#000;color:#00ff88;font-family:'Courier New',monospace;min-height:100vh;overflow:hidden;position:relative;}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%,rgba(0,40,20,0.3) 0%,transparent 50%),radial-gradient(circle at 80% 20%,rgba(0,60,30,0.2) 0%,transparent 50%),radial-gradient(circle at 40% 80%,rgba(0,80,40,0.2) 0%,transparent 50%);pointer-events:none;z-index:-1;}

/* ANA SAYFA STÄ°LLERÄ° */
.main-menu {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    min-height: 100vh;
    padding: 20px;
    position: relative;
}

.pulse{animation:pulse 3s ease-in-out infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.7;}}
h1{font-size:clamp(2.5rem,8vw,4.5rem);margin-bottom:.5rem;text-shadow:0 0 10px #00ff88,0 0 20px #00ff88;letter-spacing:3px;}
.subtitle{font-size:clamp(.9rem,3vw,1.2rem);margin-bottom:2rem;color:#88ffaa;max-width:600px;line-height:1.5;}
.worlds-container{display:flex;justify-content:center;gap:clamp(20px,5vw,60px);margin:3rem 0;flex-wrap:wrap;}
.world-option{cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;align-items:center;}
.world-option:hover{transform:translateY(-10px);}
.world-option.selected{transform:scale(1.05);}
.world-circle{width:clamp(120px,25vw,200px);height:clamp(120px,25vw,200px);border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:1rem;position:relative;overflow:hidden;box-shadow:0 0 30px rgba(0,255,136,0.2);border:3px solid transparent;transition:all .3s ease;}
.world-option.selected .world-circle{border-color:#00ff88;box-shadow:0 0 40px rgba(0,255,136,0.5);}
.world-circle.lifeless{background:radial-gradient(circle at 30% 30%,#1a5c3a,#0a2a1a);}
.world-circle.corrupted{background:radial-gradient(circle at 30% 30%,#5c1a3a,#2a0a1a);position:relative;}
.world-circle.corrupted.locked::after{content:'ðŸ”’';position:absolute;font-size:2rem;color:rgba(255,255,255,.7);text-shadow:0 0 10px #ff0066;z-index:2;}
.world-circle.corrupted.locked{filter:grayscale(.7) brightness(.5);cursor:not-allowed;}
.world-circle.corrupted.locked:hover{transform:none;}
.world-circle.corrupted::before{content:'';position:absolute;width:100%;height:100%;background:radial-gradient(circle at 70% 20%,rgba(255,0,102,.3),transparent 50%),radial-gradient(circle at 30% 70%,rgba(153,0,76,.3),transparent 50%);animation:corrupt-pulse 4s ease-in-out infinite alternate;}
@keyframes corrupt-pulse{0%{opacity:.3;}100%{opacity:.7;}}
.world-icon{font-size:clamp(3rem,8vw,5rem);filter:drop-shadow(0 0 10px currentColor);}
.world-name{font-size:clamp(1rem,2.5vw,1.3rem);margin-bottom:.5rem;font-weight:bold;letter-spacing:1px;}
.world-desc{font-size:clamp(.8rem,2vw,1rem);color:#88ffaa;max-width:200px;line-height:1.4;}
.warning-message{color:#ff9966;font-size:clamp(.9rem,2.5vw,1.1rem);margin:1rem 0 2rem;max-width:500px;padding:10px 20px;background:rgba(255,153,102,.1);border-radius:8px;border:1px solid #ff9966;display:none;animation:fadeIn .5s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}
.start-button{background:transparent;border:2px solid #00ff88;color:#00ff88;font-size:clamp(1.2rem,4vw,1.8rem);padding:1rem 2.5rem;border-radius:50px;cursor:pointer;transition:all .3s ease;font-family:'Courier New',monospace;font-weight:bold;letter-spacing:2px;text-decoration:none;display:none;margin-top:2rem;box-shadow:0 0 15px rgba(0,255,136,.3);}
.start-button:hover,.start-button:focus{background:rgba(0,255,136,.1);box-shadow:0 0 25px rgba(0,255,136,.5);transform:scale(1.05);}
.start-button:active{transform:scale(.98);}
.start-button.visible{display:inline-block;animation:pulse 2s ease-in-out infinite;}

/* GENESIS OYUN ALANI STÄ°LLERÄ° - TAM SAYFA KAPLAYACAK */
.game-area {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    display: none;
    z-index: 1000;
    overflow: hidden;
}

.game-area.active {
    display: block;
}

/* Genesis sayfasÄ±ndaki tÃ¼m stiller */
.resource{position:absolute;pointer-events:none;will-change:transform;}
.entity{position:absolute;display:flex;align-items:center;justify-content:center;will-change:transform;box-sizing:border-box;}
.lightning-emoji{font-size:32px;user-select:none;pointer-events:none;}
.capsule{width:80px;height:80px;border-radius:50%;background:rgba(255,255,255,0.1);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;box-sizing:border-box;overflow:visible;box-shadow:0 0 15px rgba(0,255,136,0.3);}
.capsule.double-ring{border:3px double #00ff88;background:rgba(255,255,255,0.05);}
.capsule.single-ring{border:2px solid #00ff88;background:rgba(255,255,255,0.05);}
.slot{width:100%;display:flex;align-items:center;justify-content:center;margin-top:6px;}
.message{position:absolute;left:50%;top:10%;transform:translateX(-50%);background:rgba(0,255,136,0.1);padding:12px 24px;border-radius:8px;font-size:clamp(1rem,3vw,1.3rem);opacity:0;transition:opacity 0.6s;border:1px solid #00ff88;box-shadow:0 0 20px rgba(0,255,136,0.3);z-index:100;text-align:center;max-width:90%;backdrop-filter:blur(5px);}
.action-btn{position:fixed;left:50%;transform:translateX(-50%);bottom:30px;padding:14px 28px;border-radius:50px;border:2px solid #00ff88;background:rgba(0,255,136,0.1);color:#00ff88;font-size:clamp(1rem,3vw,1.3rem);display:none;font-family:'Courier New',monospace;font-weight:bold;letter-spacing:1px;cursor:pointer;transition:all 0.3s ease;box-shadow:0 0 20px rgba(0,255,136,0.3);z-index:100;backdrop-filter:blur(5px);}
.action-btn:hover{background:rgba(0,255,136,0.2);box-shadow:0 0 30px rgba(0,255,136,0.5);transform:translateX(-50%) scale(1.05);}
.floating-particles{position:fixed;width:100%;height:100%;pointer-events:none;z-index:-1;}
.particle{position:absolute;width:2px;height:2px;background:#00ff88;border-radius:50%;animation:float linear infinite;}
@keyframes float{to{transform:translateY(-100vh);}}

@media(max-width:768px){.capsule{width:60px;height:60px;}.lightning-emoji{font-size:24px;}.message{top:5%;padding:10px 20px;}.action-btn{padding:12px 24px;bottom:20px;}}
@media(max-height:600px){.message{top:5%;font-size:0.9rem;}.action-btn{bottom:15px;padding:10px 20px;}}
.footer{position:fixed;bottom:20px;color:#008844;font-size:.8rem;}
@media(max-width:768px){.worlds-container{gap:30px;margin:2rem 0;}.start-button{padding:.8rem 2rem;margin-top:1.5rem;}}@media(max-height:600px){.subtitle{margin-bottom:1rem;}.worlds-container{margin:1.5rem 0;}}@media(max-width:480px){.worlds-container{flex-direction:column;align-items:center;}.world-option{width:100%;max-width:250px;}}
</style>

</head>
<body>
    <!-- Ana MenÃ¼ -->
    <div class="main-menu" id="main-menu">
        <div class="floating-particles" id="menu-particles"></div>
        
        <h1 class="pulse">LUCA</h1>
        <div class="subtitle">LAST UNIVERSAL COMMON ANCESTOR</div>
        
        <div class="worlds-container">
            <!-- Lifeless World -->
            <div class="world-option" id="lifeless-world" data-world="lifeless">
                <div class="world-circle lifeless">
                    <div class="world-icon">ðŸŸ£</div>
                </div>
                <div class="world-name">LIFELESS WORLD</div>
                <div class="world-desc">Standard path.</div>
            </div>
            
            <!-- Corrupted World -->
            <div class="world-option" id="corrupted-world" data-world="corrupted">
                <div class="world-circle corrupted locked">
                    <div class="world-icon">ðŸŸ¡</div>
                </div>
                <div class="world-name">CORRUPTED WORLD</div>
                <div class="world-desc">Alternate paths...</div>
            </div>
        </div>
        
        <div class="warning-message" id="warning-message">
            Corrupt the Lifeless World first
        </div>
        
        <button class="start-button pulse" id="start-button">âš¡</button>
        
        <div class="footer">
            Â© 2025 Serhat Kiraz
        </div>
    </div>

    <!-- Genesis Oyun AlanÄ± -->
    <div class="game-area" id="game-area">
        <div class="floating-particles" id="game-particles"></div>
        
        <div id="message" class="message">Now you are alive LUCA!</div>
        <button id="hungryBtn" class="action-btn">Are you hungry LUCA?</button>
        
        <!-- Oyun elementleri JavaScript ile dinamik olarak eklenecek -->
    </div>

<script>
// =========================
// ANA MENÃœ KODLARI
// =========================
function createMenuParticles() {
    const particlesContainer = document.getElementById('menu-particles');
    const particleCount = 50;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        particle.style.left = Math.random() * 100 + 'vw';
        particle.style.top = Math.random() * 100 + 'vh';
        
        const size = Math.random() * 3 + 1;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        particle.style.animation = `float ${duration}s linear ${delay}s infinite`;
        
        particle.style.opacity = Math.random() * 0.5 + 0.1;
        
        particlesContainer.appendChild(particle);
    }
}

// World selection logic
let selectedWorld = null;
const lifelessWorld = document.getElementById('lifeless-world');
const corruptedWorld = document.getElementById('corrupted-world');
const warningMessage = document.getElementById('warning-message');
const startButton = document.getElementById('start-button');
const corruptedCircle = corruptedWorld.querySelector('.world-circle');
const mainMenu = document.getElementById('main-menu');
const gameArea = document.getElementById('game-area');

// Check localStorage for game completion
const lifelessCompleted = localStorage.getItem('lifeless_completed') === 'true';

// If lifeless world is completed, unlock corrupted world
if (lifelessCompleted) {
    corruptedCircle.classList.remove('locked');
    corruptedWorld.querySelector('.world-desc').textContent = 'Corrupted world. Alternate paths...';
}

// Lifeless world click handler
lifelessWorld.addEventListener('click', () => {
    selectWorld('lifeless');
    warningMessage.style.display = 'none';
});

// Corrupted world click handler
corruptedWorld.addEventListener('click', () => {
    if (corruptedCircle.classList.contains('locked')) {
        warningMessage.style.display = 'block';
        
        warningMessage.style.animation = 'none';
        void warningMessage.offsetWidth;
        warningMessage.style.animation = 'fadeIn 0.5s ease';
        
        corruptedWorld.style.animation = 'none';
        void corruptedWorld.offsetWidth;
        corruptedWorld.style.animation = 'shake 0.5s ease';
        
        setTimeout(() => {
            corruptedWorld.style.animation = '';
        }, 500);
        
        return;
    }
    selectWorld('corrupted');
    warningMessage.style.display = 'none';
});

// Add shake animation for warning
const style = document.createElement('style');
style.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
`;
document.head.appendChild(style);

function selectWorld(worldType) {
    lifelessWorld.classList.remove('selected');
    corruptedWorld.classList.remove('selected');
    
    if (worldType === 'lifeless') {
        lifelessWorld.classList.add('selected');
        selectedWorld = 'lifeless';
        startButton.textContent = 'Genesis';
        startButton.onclick = startGenesisGame;
    } else if (worldType === 'corrupted') {
        corruptedWorld.classList.add('selected');
        selectedWorld = 'corrupted';
        startButton.textContent = 'Corrupted World';
        startButton.onclick = () => {
            window.location.href = 'corrupted-world.html';
        };
    }
    
    startButton.classList.add('visible');
    localStorage.setItem('selected_world', selectedWorld);
}

// Genesis oyununu baÅŸlatan ana fonksiyon
function startGenesisGame() {
    mainMenu.style.display = 'none';
    gameArea.classList.add('active');
    
    // Genesis oyununu baÅŸlat
    initializeGenesisGame();
}

// =========================
// GENESIS OYUN KODLARI
// =========================
// Genesis.html'den alÄ±nan tÃ¼m oyun kodu burada
const ENTITY_SIZE = 80;
const PICKUP_RANGE = 60;
const MAX_INV = 2;
const RESOURCE_TYPES = ["purple", "gold", "white", "red"];
const LIGHTNING_EMOJI = "âš¡";

let lightnings = [];
let luca = null;
let clones = [];
let resources = [];
let heavyRain = false;
let spawnIntervalId = null;
let lightningCreationAllowed = true;
const MAX_LIGHTNINGS_BEFORE_RAIN = 5;
const MAX_TOTAL_CLONES = 5;

let initialEvolutionCompleted = false;
let rainStoppedForEvolution = false;

const messageEl = document.getElementById("message");
const hungryBtn = document.getElementById("hungryBtn");

// Helper functions
function rand(min, max) { return Math.random() * (max - min) + min; }

function createEl(tag = 'div', style = {}) { 
    const e = document.createElement(tag); 
    Object.assign(e.style, style); 
    return e; 
}

// Genesis oyun fonksiyonlarÄ±
function createGameParticles() {
    const particlesContainer = document.getElementById('game-particles');
    particlesContainer.innerHTML = '';
    const particleCount = 30;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        particle.style.left = Math.random() * 100 + 'vw';
        particle.style.top = Math.random() * 100 + 'vh';
        
        const size = Math.random() * 3 + 1;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        particle.style.animation = `float ${duration}s linear ${delay}s infinite`;
        
        particle.style.opacity = Math.random() * 0.5 + 0.1;
        
        particlesContainer.appendChild(particle);
    }
}

function spawnLightningAt(pageX, pageY) {
    if (!lightningCreationAllowed) return;
    
    const x = Math.max(0, Math.min(window.innerWidth - ENTITY_SIZE, pageX - ENTITY_SIZE / 2));
    const y = Math.max(0, Math.min(window.innerHeight - ENTITY_SIZE, pageY - ENTITY_SIZE / 2));

    const el = createEl('div', {
        left: x + "px",
        top: y + "px",
        position: "absolute",
        width: ENTITY_SIZE + "px",
        height: ENTITY_SIZE + "px",
        display: "flex",
        alignItems: "center",
        justifyContent: "center"
    });
    
    const span = document.createElement("div");
    span.className = "lightning-emoji";
    span.textContent = LIGHTNING_EMOJI;
    el.appendChild(span);
    gameArea.appendChild(el);

    const obj = {
        element: el,
        emojiEl: span,
        x, y,
        vx: rand(-1.2, 1.2),
        vy: rand(-1.2, 1.2),
        inventory: { purple: 0, gold: 0, white: 0, red: 0 },
        symbols: [],
        isLightning: true
    };
    
    lightnings.push(obj);

    if (lightnings.length >= MAX_LIGHTNINGS_BEFORE_RAIN) {
        lightningCreationAllowed = false;
        startHeavyRain();
    }
    
    return obj;
}

function attachSymbolToLightning(L, type) {
    const wrapper = createEl('div', {
        position: "absolute",
        left: (10 + Math.random() * 50) + "px",
        top: (10 + Math.random() * 50) + "px"
    });
    
    if (type === "purple") {
        Object.assign(wrapper.style, {
            width: "12px",
            height: "12px",
            background: "#a020f0",
            borderRadius: "50%",
            boxShadow: "0 0 8px #a020f0"
        });
    }
    if (type === "gold") {
        Object.assign(wrapper.style, {
            width: "12px",
            height: "12px",
            background: "#ffd700",
            borderRadius: "50%",
            boxShadow: "0 0 8px #ffd700"
        });
    }
    if (type === "white") {
        Object.assign(wrapper.style, {
            width: "14px",
            height: "14px",
            border: "2px solid #fff",
            background: "transparent",
            borderRadius: "50%",
            boxShadow: "0 0 8px #fff"
        });
    }
    if (type === "red") {
        Object.assign(wrapper.style, {
            width: "0",
            height: "0",
            borderLeft: "6px solid transparent",
            borderRight: "6px solid transparent",
            borderBottom: "10px solid #ff3030",
            filter: "drop-shadow(0 0 4px #ff3030)"
        });
    }
    
    L.element.appendChild(wrapper);
    L.symbols.push(wrapper);
}

function createCapsuleElement(x, y, includeLightningEmoji = false) {
    const wrapper = createEl('div', {
        left: x + "px",
        top: y + "px",
        position: "absolute",
        width: ENTITY_SIZE + "px",
        height: ENTITY_SIZE + "px",
        display: "flex",
        alignItems: "center",
        justifyContent: "center"
    });
    
    const capsule = createEl('div', {
        width: ENTITY_SIZE + "px",
        height: ENTITY_SIZE + "px"
    });
    
    capsule.className = "capsule single-ring";

    const slotTop = createEl('div', {
        width: "100%",
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        marginTop: "6px"
    });
    
    const slotMid = createEl('div', {
        width: "100%",
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        marginTop: "4px"
    });
    
    const slotBottom = createEl('div', {
        width: "100%",
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        marginTop: "4px"
    });

    // TOP: Red triangle
    const red = createEl('div', {});
    Object.assign(red.style, {
        width: "0",
        height: "0",
        borderLeft: "8px solid transparent",
        borderRight: "8px solid transparent",
        borderBottom: "14px solid #ff3030",
        filter: "drop-shadow(0 0 4px #ff3030)"
    });
    slotTop.appendChild(red);

    // MIDDLE: Purple and gold touching
    const p = createEl('div', {});
    Object.assign(p.style, {
        width: "16px",
        height: "16px",
        background: "#a020f0",
        borderRadius: "50%",
        marginRight: "-2px",
        boxShadow: "0 0 6px #a020f0"
    });
    
    const g = createEl('div', {});
    Object.assign(g.style, {
        width: "16px",
        height: "16px",
        background: "#ffd700",
        borderRadius: "50%",
        marginLeft: "-2px",
        boxShadow: "0 0 6px #ffd700"
    });
    
    const bottomRow = createEl('div', {
        display: "flex",
        alignItems: "center",
        justifyContent: "center"
    });
    
    bottomRow.appendChild(p);
    bottomRow.appendChild(g);
    slotMid.appendChild(bottomRow);

    // BOTTOM: Lightning emoji (only for LUCA)
    if (includeLightningEmoji) {
        const le = document.createElement("div");
        le.className = "lightning-emoji";
        le.textContent = LIGHTNING_EMOJI;
        slotBottom.appendChild(le);
    }

    capsule.appendChild(slotTop);
    capsule.appendChild(slotMid);
    capsule.appendChild(slotBottom);
    wrapper.appendChild(capsule);
    gameArea.appendChild(wrapper);

    return {
        wrapper,
        capsule,
        slots: { top: slotTop, mid: slotMid, bottom: slotBottom },
        innerTopEmoji: includeLightningEmoji ? slotBottom.querySelector('.lightning-emoji') : null
    };
}

function makeLucaFromLightning(L) {
    const x = L.x, y = L.y;
    L.symbols.forEach(s => s.remove());
    L.symbols = [];
    L.element.remove();

    const cap = createCapsuleElement(x, y, true);
    cap.capsule.classList.remove('single-ring');
    cap.capsule.classList.add('double-ring');

    const startingInventory = L.inventory || { purple: 0, gold: 0, white: 0, red: 0 };

    luca = {
        elementWrapper: cap.wrapper,
        element: cap.capsule,
        x, y,
        vx: rand(-1.2, 1.2),
        vy: rand(-1.2, 1.2),
        inventory: startingInventory,
        symbols: [],
        isLuca: true
    };

    lightnings = [];
    return luca;
}

function makeCloneAt(x, y, fromLuca = false) {
    const cap = createCapsuleElement(x, y, false);
    cap.capsule.classList.remove('single-ring');
    cap.capsule.classList.add('double-ring');

    const obj = {
        elementWrapper: cap.wrapper,
        element: cap.capsule,
        x, y,
        vx: rand(-1.2, 1.2),
        vy: rand(-1.2, 1.2),
        inventory: { purple: 0, gold: 0, white: 0, red: 0 },
        symbols: [],
        isLuca: false
    };
    
    return obj;
}

function addPickupVisualToCapsule(entityObj, type) {
    const sym = createEl('div', { position: "absolute" });
    
    if (type === "purple") {
        Object.assign(sym.style, {
            width: "12px",
            height: "12px",
            background: "#a020f0",
            borderRadius: "50%",
            boxShadow: "0 0 6px #a020f0"
        });
    }
    if (type === "gold") {
        Object.assign(sym.style, {
            width: "12px",
            height: "12px",
            background: "#ffd700",
            borderRadius: "50%",
            boxShadow: "0 0 6px #ffd700"
        });
    }
    if (type === "white") {
        Object.assign(sym.style, {
            width: "14px",
            height: "14px",
            border: "2px solid #fff",
            background: "transparent",
            borderRadius: "50%",
            boxShadow: "0 0 6px #fff"
        });
    }
    if (type === "red") {
        Object.assign(sym.style, {
            width: "0",
            height: "0",
            borderLeft: "6px solid transparent",
            borderRight: "6px solid transparent",
            borderBottom: "10px solid #ff3030",
            filter: "drop-shadow(0 0 4px #ff3030)"
        });
    }
    
    sym.style.left = (10 + Math.random() * (ENTITY_SIZE - 30)) + "px";
    sym.style.top = (10 + Math.random() * (ENTITY_SIZE - 30)) + "px";
    entityObj.elementWrapper.appendChild(sym);
    entityObj.symbols.push(sym);
}

function clearVisualsFromCapsule(entityObj) {
    if (entityObj.symbols) {
        entityObj.symbols.forEach(s => s.remove());
        entityObj.symbols = [];
    }
}

function spawnResource(type, x) {
    const el = createEl('div', {
        position: "absolute",
        left: (x !== undefined ? x : rand(10, window.innerWidth - 30)) + "px",
        top: "-40px"
    });
    
    el.className = "resource";
    
    if (type === "red") {
        Object.assign(el.style, {
            width: "0",
            height: "0",
            borderLeft: "12px solid transparent",
            borderRight: "12px solid transparent",
            borderBottom: "24px solid #ff3030",
            filter: "drop-shadow(0 0 8px #ff3030)"
        });
    } else {
        const size = (type === "white") ? 28 : 22;
        Object.assign(el.style, {
            width: size + "px",
            height: size + "px",
            borderRadius: "50%"
        });
        
        if (type === "white") {
            el.style.background = "transparent";
            el.style.border = "3px solid #fff";
            el.style.boxShadow = "0 0 10px #fff";
        } else {
            el.style.background = (type === "purple") ? "#a020f0" : "#ffd700";
            el.style.boxShadow = "0 0 10px " + ((type === "purple") ? "#a020f0" : "#ffd700");
        }
    }
    
    gameArea.appendChild(el);
    resources.push({ element: el, type, x: parseFloat(el.style.left), y: -40 });
}

function startHeavyRain() {
    heavyRain = true;
    if (spawnIntervalId) clearInterval(spawnIntervalId);
    
    spawnIntervalId = setInterval(() => {
        const count = Math.floor(rand(3, 6));
        for (let i = 0; i < count; i++) {
            const t = RESOURCE_TYPES[Math.floor(Math.random() * RESOURCE_TYPES.length)];
            spawnResource(t);
        }
    }, 300);
}

function stopRain() {
    heavyRain = false;
    if (spawnIntervalId) {
        clearInterval(spawnIntervalId);
        spawnIntervalId = null;
    }
}

function performInitialEvolution(L) {
    stopRain();
    rainStoppedForEvolution = true;
    
    showMessage("Now you are alive LUCA!", 5000);
    
    lightnings.forEach(other => {
        if (other !== L) {
            other.element.remove();
        }
    });
    
    lightnings = [L];
    const Lx = L.x, Ly = L.y;
    L.element.remove();

    const cap = createCapsuleElement(Lx, Ly, true);
    cap.capsule.classList.remove('single-ring');
    cap.capsule.classList.add('double-ring');

    luca = {
        elementWrapper: cap.wrapper,
        element: cap.capsule,
        x: Lx, y: Ly,
        vx: rand(-1.2, 1.2),
        vy: rand(-1.2, 1.2),
        inventory: { purple: 0, gold: 0, white: 0, red: 0 },
        symbols: [],
        isLuca: true
    };

    lightnings = [];
    initialEvolutionCompleted = true;
    
    setTimeout(() => {
        const clone = makeCloneAt(Lx + 50, Ly + 50, true);
        clone.inventory = { purple: 0, gold: 0, white: 0, red: 0 };
        clones.push(clone);
        
        setTimeout(() => {
            rainStoppedForEvolution = false;
            startHeavyRain();
        }, 5000);
    }, 1000);
}

function checkLightningsPickup() {
    for (let li = lightnings.length - 1; li >= 0; li--) {
        const L = lightnings[li];
        updateMovement(L);
        
        for (let ri = resources.length - 1; ri >= 0; ri--) {
            const r = resources[ri];
            const rcx = r.x + 10, rcy = r.y + 10;
            const lx = L.x + ENTITY_SIZE / 2, ly = L.y + ENTITY_SIZE / 2;
            const d = Math.hypot(rcx - lx, rcy - ly);
            
            if (d < PICKUP_RANGE) {
                const t = r.type;
                if ((L.inventory[t] || 0) < MAX_INV) {
                    L.inventory[t] = (L.inventory[t] || 0) + 1;
                    attachSymbolToLightning(L, t);
                    r.element.remove();
                    resources.splice(ri, 1);

                    if (RESOURCE_TYPES.every(k => (L.inventory[k] || 0) >= MAX_INV)) {
                        performInitialEvolution(L);
                        return;
                    }
                }
            }
        }
    }
}

function updateMovement(obj) {
    obj.x += obj.vx;
    obj.y += obj.vy;
    
    if (obj.x < 0) { obj.x = 0; obj.vx *= -1; }
    if (obj.y < 0) { obj.y = 0; obj.vy *= -1; }
    if (obj.x > window.innerWidth - ENTITY_SIZE) { 
        obj.x = window.innerWidth - ENTITY_SIZE; 
        obj.vx *= -1; 
    }
    if (obj.y > window.innerHeight - ENTITY_SIZE) { 
        obj.y = window.innerHeight - ENTITY_SIZE; 
        obj.vy *= -1; 
    }
    
    if (obj.element) {
        obj.element.style.left = obj.x + "px";
        obj.element.style.top = obj.y + "px";
    }
    if (obj.elementWrapper) {
        obj.elementWrapper.style.left = obj.x + "px";
        obj.elementWrapper.style.top = obj.y + "px";
    }
}

function updateResources() {
    for (let i = resources.length - 1; i >= 0; i--) {
        const r = resources[i];
        r.y += heavyRain ? 5.0 : 2.3;
        r.element.style.top = r.y + "px";
        r.x = parseFloat(r.element.style.left);
        
        if (r.y > window.innerHeight + 80) {
            r.element.remove();
            resources.splice(i, 1);
        }
    }
}

function checkLucaAndClonesPickupAndDivision() {
    if (luca) updateMovement(luca);
    clones.forEach(c => updateMovement(c));

    const living = [];
    if (luca) living.push(luca);
    clones.forEach(c => living.push(c));

    for (const ent of living) {
        for (let ri = resources.length - 1; ri >= 0; ri--) {
            const r = resources[ri];
            const rcx = r.x + 10, rcy = r.y + 10;
            const ex = ent.x + ENTITY_SIZE / 2, ey = ent.y + ENTITY_SIZE / 2;
            const d = Math.hypot(rcx - ex, rcy - ey);
            
            if (d < PICKUP_RANGE) {
                const t = r.type;
                if ((ent.inventory[t] || 0) < MAX_INV) {
                    ent.inventory[t] = (ent.inventory[t] || 0) + 1;
                    addPickupVisualToCapsule(ent, t);
                    r.element.remove();
                    resources.splice(ri, 1);

                    if (RESOURCE_TYPES.every(k => (ent.inventory[k] || 0) >= MAX_INV)) {
                        createNewCloneFromEntity(ent);
                        break;
                    }
                }
            }
        }
        
        if (clones.length >= MAX_TOTAL_CLONES) {
            handleFinalStage();
            break;
        }
    }
}

function createNewCloneFromEntity(parentEntity) {
    const newClone = makeCloneAt(parentEntity.x + 30, parentEntity.y + 30);
    
    RESOURCE_TYPES.forEach(k => {
        parentEntity.inventory[k] = 0;
        newClone.inventory[k] = 0;
    });
    
    clearVisualsFromCapsule(parentEntity);
    clearVisualsFromCapsule(newClone);
    
    clones.push(newClone);
    
    if (clones.length >= MAX_TOTAL_CLONES) {
        handleFinalStage();
    }
}

function handleFinalStage() {
    stopRain();
    rainStoppedForEvolution = true;
    
    setTimeout(() => {
        showMessage("RESOURCES DEPLETED", 4000);
        setTimeout(() => {
            hungryBtn.style.display = "block";
        }, 2000);
    }, 2000);
}

function showMessage(text, ms = 3000) {
    messageEl.textContent = text;
    messageEl.style.opacity = "1";
    setTimeout(() => {
        messageEl.style.opacity = "0";
    }, ms);
}

function mainLoop() {
    if (!initialEvolutionCompleted) {
        checkLightningsPickup();
    } else {
        checkLucaAndClonesPickupAndDivision();
    }

    updateResources();
    requestAnimationFrame(mainLoop);
}

// Event Listeners
function onPointerCreate(x, y) {
    if (!lightningCreationAllowed) return;
    spawnLightningAt(x, y);
}

gameArea.addEventListener("click", (e) => {
    onPointerCreate(e.clientX, e.clientY);
});

gameArea.addEventListener("touchstart", (e) => {
    e.preventDefault();
    const t = e.touches[0];
    if (t) onPointerCreate(t.clientX, t.clientY);
}, { passive: false });

hungryBtn.addEventListener("click", () => {
    // 3.html'ye yÃ¶nlendirme yapabilirsiniz veya baÅŸka bir iÅŸlem
    window.location.href = "3.html";
});

function initializeGenesisGame() {
    createGameParticles();
    mainLoop();
}

// =========================
// Ä°NÄ°TÄ°ALÄ°ZATÄ°ON
// =========================
document.addEventListener('DOMContentLoaded', () => {
    createMenuParticles();
    
    if (!lifelessCompleted) {
        selectWorld('lifeless');
    }
    
    document.addEventListener('contextmenu', (e) => {
        if (window.innerWidth <= 768) {
            e.preventDefault();
        }
    });
    
    const worlds = document.querySelectorAll('.world-option');
    worlds.forEach(world => {
        world.addEventListener('touchstart', function() {
            this.style.opacity = '0.8';
        });
        
        world.addEventListener('touchend', function() {
            this.style.opacity = '1';
        });
    });
});
</script>
</body>
</html>
